<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
	<link rel="stylesheet" href="css/style.css">
	<title>Quản Lý Tài Khoản - Clinic Admin</title>
</head>
<body>

<!-- SIDEBAR -->
<section id="sidebar">
	<a href="#" class="brand">
		<i class='bx bxs-clinic'></i>
		<span class="text">PETCARE</span>
	</a>
	<ul class="side-menu top">
		<li><a href="index.html"><i class='bx bxs-dashboard'></i><span class="text">Dashboard</span></a></li>
		<li><a href="services.html"><i class='bx bxs-briefcase-alt-2'></i><span class="text">Dịch Vụ</span></a></li>
		<li><a href="doctors.html"><i class='bx bxs-user-voice'></i><span class="text">Bác Sĩ</span></a></li>
		<li><a href="appointments.html"><i class='bx bxs-calendar'></i><span class="text">Lịch Hẹn</span></a></li>
		<li class="active"><a href="customers.html"><i class='bx bxs-group'></i><span class="text">Khách Hàng</span></a></li>
		<li><a href="blogs.html"><i class='bx bxs-book-content'></i><span class="text">Blogs</span></a></li>
		<li><a href="schedule.html"><i class='bx bxs-time-five'></i><span class="text">Lịch Làm Việc</span></a></li>
		<li><a href="AccountManagement.html"><i class='bx bxs-user-account'></i><span class="text">Quản Lý Tài Khoản</span></a></li>
	</ul>
</section>

<section id="content">
    <nav>
        <i class='bx bx-menu'></i>
        <a href="#" class="nav-link">Quản lý Khách Hàng</a>
        <form action="#">
            <div class="form-input">
                <input type="search" placeholder="Tìm tên chủ, tên pet...">
                <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
            </div>
        </form>
        <input type="checkbox" id="switch-mode" hidden>
        <!-- <a href="#" class="notification">
            <i class='bx bxs-bell'></i>
            <span class="num">3</span>
        </a> -->
        <a href="#" class="profile">
            <img src="img/bs1.jpg" alt="Profile">
        </a>
    </nav>

    <main>
        <div class="account-header">
            <div>
                <h1>Danh Sách Khám Bệnh</h1>
                <p style="color: #666; margin-top: 5px;">Theo dõi lịch sử khám của khách hàng và thú cưng</p>
            </div>
            <button class="add-btn" id="btnAdd">
                <i class='bx bx-plus'></i>
                Tiếp nhận mới
            </button>
        </div>

        <div class="account-filters">
            <input type="text" class="search-input" id="searchInput" placeholder="Tìm kiếm...">
            <select class="filter-select" id="filterService">
                <option value="">Tất cả dịch vụ</option>
                <option value="Khám Tổng Quát">Khám Tổng Quát</option>
                <option value="Tiêm Phòng">Tiêm Phòng</option>
                <option value="Phẫu Thuật">Phẫu Thuật</option>
                <option value="Cắt Tỉa Lông">Spa / Cắt Tỉa</option>
            </select>
        </div>

        <div class="table-wrapper">
            <table id="vetTable">
                <thead>
                    <tr>
                        <th style="padding-left: 20px;">KHÁCH HÀNG</th>
                        <th>THÚ CƯNG</th>
                        <th>BÁC SĨ</th>
                        <th>DỊCH VỤ</th>
                        <th>NGÀY</th>
                        <th style="text-align: center;">HÀNH ĐỘNG</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr data-id="1">
                        <td style="font-weight: bold; padding-left: 20px;">Nguyễn Văn A</td>
                        <td>
                            <div class="pet-info">
                                <div class="pet-avatar"><i class='bx bxs-dog'></i></div>
                                <span>Milo</span>
                            </div>
                        </td>
                        <td>BS. Trần Thị B</td>
                        <td><span class="service-tag sv-kham">Khám Tổng Quát</span></td>
                        <td>23-11-2025</td>
                        <td>
                            <div class="user-actions">
                                <i class='bx bx-edit' title="Sửa"></i>
                                <i class='bx bx-trash' title="Xóa"></i>
                            </div>
                        </td>
                    </tr>

                    <tr data-id="2">
                        <td style="font-weight: bold; padding-left: 20px;">Lê Thị C</td>
                        <td>
                            <div class="pet-info">
                                <div class="pet-avatar"><i class='bx bxs-cat'></i></div>
                                <span>Luna</span>
                            </div>
                        </td>
                        <td>BS. Phạm Văn D</td>
                        <td><span class="service-tag sv-tiem">Tiêm Phòng</span></td>
                        <td>23-11-2025</td>
                        <td>
                            <div class="user-actions">
                                <i class='bx bx-edit' title="Sửa"></i>
                                <i class='bx bx-trash' title="Xóa"></i>
                            </div>
                        </td>
                    </tr>

                    <tr data-id="3">
                        <td style="font-weight: bold; padding-left: 20px;">Hoàng Văn E</td>
                        <td>
                            <div class="pet-info">
                                <div class="pet-avatar"><i class='bx bxs-dog'></i></div>
                                <span>Max</span>
                            </div>
                        </td>
                        <td>BS. Trần Thị B</td>
                        <td><span class="service-tag sv-pt">Phẫu Thuật</span></td>
                        <td>23-11-2025</td>
                        <td>
                            <div class="user-actions">
                                <i class='bx bx-edit' title="Sửa"></i>
                                <i class='bx bx-trash' title="Xóa"></i>
                            </div>
                        </td>
                    </tr>

                    <tr data-id="4">
                        <td style="font-weight: bold; padding-left: 20px;">Đặng Thị F</td>
                        <td>
                            <div class="pet-info">
                                <div class="pet-avatar"><i class='bx bxs-dog'></i></div>
                                <span>Kai</span>
                            </div>
                        </td>
                        <td>BS. Lê Văn G</td>
                        <td><span class="service-tag sv-kham">Khám Tổng Quát</span></td>
                        <td>22-11-2025</td>
                        <td>
                            <div class="user-actions">
                                <i class='bx bx-edit' title="Sửa"></i>
                                <i class='bx bx-trash' title="Xóa"></i>
                            </div>
                        </td>
                    </tr>

                    <tr data-id="5">
                        <td style="font-weight: bold; padding-left: 20px;">Phan Văn H</td>
                        <td>
                            <div class="pet-info">
                                <div class="pet-avatar"><i class='bx bxs-cat'></i></div>
                                <span>Bella</span>
                            </div>
                        </td>
                        <td>BS. Nguyễn Thị I</td>
                        <td><span class="service-tag sv-spa">Cắt Tỉa Lông</span></td>
                        <td>22-11-2025</td>
                        <td>
                            <div class="user-actions">
                                <i class='bx bx-edit' title="Sửa"></i>
                                <i class='bx bx-trash' title="Xóa"></i>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>
</section>

<div id="vetModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
    <div class="modal-content" style="background-color: #fff; padding: 25px; border-radius: 8px; width: 500px; max-width: 90%;">
        <h2 id="modalTitle" style="margin-bottom: 20px; color: #333;">Tiếp Nhận Ca Mới</h2>
        <form id="vetForm">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Tên Khách Hàng</label>
                <input type="text" id="inpCustomer" required placeholder="VD: Nguyễn Văn A" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
                <div style="flex: 2;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Tên Thú Cưng</label>
                    <input type="text" id="inpPetName" required placeholder="VD: Milo" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Loại</label>
                    <select id="inpPetType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="dog">Chó</option>
                        <option value="cat">Mèo</option>
                    </select>
                </div>
            </div>

            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Bác Sĩ Phụ Trách</label>
                    <select id="inpDoctor" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="BS. Trần Thị B">BS. Trần Thị B</option>
                        <option value="BS. Phạm Văn D">BS. Phạm Văn D</option>
                        <option value="BS. Lê Văn G">BS. Lê Văn G</option>
                        <option value="BS. Nguyễn Thị I">BS. Nguyễn Thị I</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Dịch Vụ</label>
                    <select id="inpService" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="Khám Tổng Quát">Khám Tổng Quát</option>
                        <option value="Tiêm Phòng">Tiêm Phòng</option>
                        <option value="Phẫu Thuật">Phẫu Thuật</option>
                        <option value="Cắt Tỉa Lông">Cắt Tỉa Lông</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Ngày Khám</label>
                <input type="date" id="inpDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="modal-actions" style="display: flex; justify-content: flex-end; gap: 10px;">
                <button type="button" id="btnCancel" style="padding: 8px 16px; background: #eee; border: none; border-radius: 4px; cursor: pointer;">Hủy</button>
                <button type="submit" style="padding: 8px 16px; background: #3C91E6; color: white; border: none; border-radius: 4px; cursor: pointer;">Lưu Thông Tin</button>
            </div>
        </form>
    </div>
</div>

<script>
// --- SIDEBAR ---
const menuBar = document.querySelector('#content nav .bx.bx-menu');
const sidebar = document.getElementById('sidebar');
menuBar.addEventListener('click', () => sidebar.classList.toggle('hide'));

const switchMode = document.getElementById('switch-mode');
if(switchMode) {
    switchMode.addEventListener('change', () => document.body.classList.toggle('dark'));
}

// --- LOGIC BẢNG THÚ Y ---
const searchInput = document.getElementById('searchInput');
const filterService = document.getElementById('filterService');
const tableBody = document.getElementById('tableBody');

function filterTable() {
    const term = searchInput.value.toLowerCase();
    const serviceFilter = filterService.value.toLowerCase();
    const rows = tableBody.getElementsByTagName('tr');

    for (let row of rows) {
        // Cột: 0-Tên khách, 1-Pet, 2-Bác sĩ, 3-Dịch vụ, 4-Ngày
        const customer = row.cells[0].textContent.toLowerCase();
        const pet = row.cells[1].textContent.toLowerCase();
        const service = row.cells[3].textContent.toLowerCase();

        const matchSearch = customer.includes(term) || pet.includes(term);
        const matchService = !serviceFilter || service.includes(serviceFilter);

        row.style.display = (matchSearch && matchService) ? '' : 'none';
    }
}

searchInput.addEventListener('input', filterTable);
filterService.addEventListener('change', filterTable);

// --- MODAL & FORM ---
const modal = document.getElementById('vetModal');
const btnAdd = document.getElementById('btnAdd');
const btnCancel = document.getElementById('btnCancel');
const form = document.getElementById('vetForm');
const modalTitle = document.getElementById('modalTitle');
let editingRowId = null;

// Helpers
const getServiceClass = (svName) => {
    if(svName.includes('Khám')) return 'sv-kham';
    if(svName.includes('Tiêm')) return 'sv-tiem';
    if(svName.includes('Phẫu')) return 'sv-pt';
    return 'sv-spa';
};

const formatDateDisplay = (dateStr) => {
    const d = new Date(dateStr);
    return `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`;
}

btnAdd.addEventListener('click', () => {
    modalTitle.textContent = 'Tiếp Nhận Ca Mới';
    form.reset();
    // Set mặc định ngày hôm nay
    document.getElementById('inpDate').valueAsDate = new Date();
    editingRowId = null;
    modal.style.display = 'flex';
});

btnCancel.addEventListener('click', () => modal.style.display = 'none');
modal.addEventListener('click', (e) => { if(e.target === modal) modal.style.display = 'none'; });

form.addEventListener('submit', (e) => {
    e.preventDefault();
    
    // Get values
    const customer = document.getElementById('inpCustomer').value;
    const petName = document.getElementById('inpPetName').value;
    const petType = document.getElementById('inpPetType').value; // dog/cat
    const doctor = document.getElementById('inpDoctor').value;
    const service = document.getElementById('inpService').value;
    const dateVal = document.getElementById('inpDate').value;
    
    const dateDisplay = formatDateDisplay(dateVal);
    const petIcon = petType === 'dog' ? 'bxs-dog' : 'bxs-cat';
    const svClass = getServiceClass(service);

    if(editingRowId) {
        // Edit mode
        const row = document.querySelector(`tr[data-id="${editingRowId}"]`);
        row.cells[0].textContent = customer;
        row.cells[1].innerHTML = `
            <div class="pet-info">
                <div class="pet-avatar"><i class='bx ${petIcon}'></i></div>
                <span>${petName}</span>
            </div>`;
        row.cells[2].textContent = doctor;
        row.cells[3].innerHTML = `<span class="service-tag ${svClass}">${service}</span>`;
        row.cells[4].textContent = dateDisplay;
    } else {
        // Add mode
        const newId = tableBody.rows.length + 1;
        const newRow = document.createElement('tr');
        newRow.setAttribute('data-id', newId);
        newRow.innerHTML = `
            <td style="font-weight: bold; padding-left: 20px;">${customer}</td>
            <td>
                <div class="pet-info">
                    <div class="pet-avatar"><i class='bx ${petIcon}'></i></div>
                    <span>${petName}</span>
                </div>
            </td>
            <td>${doctor}</td>
            <td><span class="service-tag ${svClass}">${service}</span></td>
            <td>${dateDisplay}</td>
            <td>
                <div class="user-actions">
                    <i class='bx bx-edit' title="Sửa"></i>
                    <i class='bx bx-trash' title="Xóa"></i>
                </div>
            </td>
        `;
        tableBody.appendChild(newRow);
    }
    modal.style.display = 'none';
});

// Edit & Delete Events
tableBody.addEventListener('click', (e) => {
    const target = e.target;
    const row = target.closest('tr');
    if(!row) return;

    if(target.classList.contains('bx-trash')) {
        if(confirm('Xóa bản ghi này?')) row.remove();
    }

    if(target.classList.contains('bx-edit')) {
        editingRowId = row.getAttribute('data-id');
        modalTitle.textContent = 'Chỉnh Sửa Thông Tin';
        
        // Fill data form
        document.getElementById('inpCustomer').value = row.cells[0].textContent;
        document.getElementById('inpPetName').value = row.cells[1].querySelector('span').textContent;
        
        // Detect pet icon to set select box
        const iconClass = row.cells[1].querySelector('i').className;
        document.getElementById('inpPetType').value = iconClass.includes('dog') ? 'dog' : 'cat';

        document.getElementById('inpDoctor').value = row.cells[2].textContent;
        document.getElementById('inpService').value = row.cells[3].textContent.trim();
        
        // Date reverse parsing (dd-mm-yyyy -> yyyy-mm-dd)
        const dateParts = row.cells[4].textContent.split('-');
        document.getElementById('inpDate').value = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;

        modal.style.display = 'flex';
    }
});

</script>
</body>
</html>